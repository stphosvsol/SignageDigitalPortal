@model SignageDigitalPortal.Models.Entities.ManagerSignangeModel

@{
    ViewBag.Title = "Administrador";
    Layout = null;
}

<html>
<head>
    <title>Administrador</title>
    <link href="~/Content/bootstrap.theme.min.css" rel="stylesheet" />
    <link href="~/Content/Site.css" rel="stylesheet" />
    @Scripts.Render("~/bundles/modernizr")
    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")
    @Scripts.Render("~/bundles/jqueryval")
    <script src="~/Scripts/angular.min.js"></script>
    <script src="~/Scripts/App/Shared/mainApp.js"></script>
    <script src="~/Scripts/common.js"></script>
    <script src="~/Scripts/App/Directives/pntInnDrct.js"></script>
    <script src="~/Scripts/App/Directives/channelDivDrct.js"></script>

    <script>
        app.controller('screenController', function($scope, $rootScope, $timeout) {
            $scope.screenSizes = @Html.Raw(ViewBag.ScreenSizes);
            $scope.screenSize = $scope.screenSizes[0];

            $scope.screenSizeChange = function() {
                $rootScope.$broadcast('screenSizeChange', $scope.screenSize);
            };

            $timeout(function() {
                $scope.screenSizeChange();
            }, 0);
        });

        app.controller('channelController', function ($scope, $rootScope) {
            $scope.channels = [];
            $scope.channelSel = {};

            $scope.addChannel = function(formId) {
                if ($(formId).valid() !== true) {
                    return;
                }

                $scope.channelSel = { w: 200, h: 200, x: 0, y: 0, z: 0, active: false, selected: true, name: $scope.channelSel.name };
                $scope.channels.push($scope.channelSel);
                $rootScope.$broadcast('onChannelAdd', $scope.channels);
            };
        });

        app.controller('preViewController', function ($scope) {
            $scope.screen = {w:0, h:0};
            //$scope.channels = [{w:200, h:200, x:0, y:0, z:0, active:false}, {w:100, h:200, x:0, y:300, z:0, active:false}, {w:300, h:500, x:300, y:0, z:0, active:false}];
            $scope.channels = [];

            $scope.$on('onChannelAdd', function(ev, dt) {
                $scope.channels = dt;
            });

            $scope.$on('screenSizeChange', function(ev, dt) {
                $scope.screen.w = dt.Value.SizeX;
                $scope.screen.h = dt.Value.SizeY;
            });
        });

    </script>

</head>
<body ng-app="mgmSignage" ng-cloak>
    <div class="row" style="margin: 5px">
        <div class="col-xs-2 col-xs-offset-3">
            <div class="panel panel-info" ng-controller="screenController">
                <div class="panel-heading element-center"><span class="glyphicon glyphicon-th"></span>&nbsp;&nbsp;Pantalla</div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-xs-12 element-center">
                            <span class="control-label">Tamaño de la ventana</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-10 col-xs-offset-1">
                            <select class="form-control element-center" ng-model="screenSize" ng-options="d.Value.Name for d in screenSizes" ng-change="screenSizeChange()"></select>
                        </div>
                    </div>
                    <br />
                    <div class="row">
                        <div class="col-xs-10 col-xs-offset-1 element-center">
                            <label class="control-label">Nombre de la pantalla</label>
                            @Html.TextBoxFor(m => m.ScreenInfo.Name, new { @class = "form-control", ng_model = "screenInfo.Name" })
                            <div class="control-label element-left">
                                @Html.ValidationMessageFor(m => m.ScreenInfo.Name)
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xs-2 pad-main-col">
            <div class="panel panel-success" ng-controller="channelController">
                <div class="panel-heading element-center"><span class="glyphicon glyphicon-sd-video"></span>&nbsp;&nbsp;Canal</div>
                <div class="panel-body">
                    <form id="ChannelForm">
                        <div class="row">
                            <div class="col-xs-10 col-xs-offset-1 element-center">
                                <label class="control-label">Nombre del canal</label>
                                @Html.TextBoxFor(m => m.ChannelSel.Name, new { @class = "form-control", ng_model = "channelSel.name" })
                                <div class="control-label element-left">
                                    @Html.ValidationMessageFor(m => m.ChannelSel.Name)
                                </div>
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-xs-6 element-center">
                                <div class="btn btn-success" ng-click="addChannel('#ChannelForm')"><span class="glyphicon glyphicon-plus"></span>&nbsp;&nbsp;Agregar</div>
                            </div>
                            <div class="col-xs-6 element-center">
                                <div class="btn btn-danger"><span class="glyphicon glyphicon-minus"></span>&nbsp;&nbsp;Eliminar</div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </div>

    <div ng-controller="preViewController">
        <div class="row screen-wrapper" ng-style="{width:screen.w + 50}">
            <div class="col-xs-12 pad-main-col">
                <div class="panel panel-primary">
                    <div class="panel-heading element-center"><span class="glyphicon glyphicon-picture"></span>&nbsp;&nbsp; Previsualización de la pantalla</div>
                    <div class="panel-body" style="background-color: white">
                        <div id="screen-main" ng-model="screen" ng-style="{width:screen.w, height:screen.h}">
                            <div ng-repeat="channel in channels">
                                <channel-div channel="channel" screen="screen"></channel-div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>


