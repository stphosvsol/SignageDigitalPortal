@using SignageDigitalPortal.Resources
@using SignageRepository.Resources
@model SignageRepository.Database.Media

@{
    Layout = null;
}


<script>

    $(document).ready(function () {
        window.showModalFormDlg("#dlgUpModalId", "#FormCatId");
        $("#uploadSingleFileId").injector().invoke(function ($compile, $rootScope) {
            $compile($("#uploadSingleFileId"))($rootScope);
            $rootScope.$apply();
        });

        var scp = angular.element($("#uploadSingleFileId")).scope();
        scp.urlToUpload = "/Upload/UploadHandler.ashx?upFile=1";
    });

</script>

<div>
    <div id="dlgUpModalId" class="modal fade" ng-controller="upsertController" ng-cloak>
        <div class="modal-dialog" style="width:800px">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="alert alert-info ">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="element-center"><i class="glyphicon glyphicon-picture"></i>&nbsp;&nbsp;@ResCatalog.TITLE_MEDIA</h4>
                    </div>
                </div>
                <div class="modal-body">
                    <form id="FormCatId" name="FormCatId" ng-submit="submit('#FormCatId')" class="form-horizontal" role="form" ng-controller="mediaController">
                        @Html.AntiForgeryToken()
                        @Html.HiddenFor(m => m.MediaId)
                        @Html.HiddenFor(m => m.SourceType, new { ng_model = "m.PersonType", ng_update_hidden = "", ng_init = "m.SourceType = " + Model.SourceType })
                        <div class="row">
                            <div class="col-xs-6 col-xs-offset-3">
                                <div class="col-xs-6">
                                    <div class="input-group">
                                        <span class="input-group-addon">
                                            @Html.RadioButtonFor(m => m.SourceType, 0, new { ng_model = "m.SourceType" })
                                        </span>
                                        <label class="form-control">Local</label>
                                    </div>
                                </div>
                                <div class="col-xs-6">
                                    <div class="input-group">
                                        <span class="input-group-addon">
                                            @Html.RadioButtonFor(m => m.SourceType, 1, new { ng_model = "m.SourceType" })
                                        </span>
                                        <label class="form-control">Externa</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <br />
                        <div class="row" ng-show="m.SourceType == 0">
                            <div class="col-xs-10 col-xs-offset-1">
                                <div class="panel panel-default panel-primary">
                                    <div class="panel-heading">
                                        <span class="glyphicon glyphicon-hdd"></span>&nbsp;&nbsp;@ResMediaRep.TITLE_MEDIA_LOCAL
                                    </div>
                                    <div class="panel-body">
                                        <div class="row">
                                            <div id="uploadSingleFileId" ng-controller="fileUploadCtrl">
                                                <div class="row">
                                                    <div class="col-xs-10 col-xs-offset-1 element-center">
                                                        <label><span class="glyphicon glyphicon-eye-open"></span>&nbsp;&nbsp;Visualización de la media</label>
                                                    </div>
                                                    <div class="col-xs-10 col-xs-offset-1 element-center">
                                                        <label class="btn btn-primary btn-sm" for="fileToUpload">Elegir media</label><br />
                                                        <input type="file" ng-model-instant id="fileToUpload" single ng-show="false"
                                                               onchange="angular.element(this).scope().setFiles(this, '#FormCatId')" />
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-xs-12 element-center">
                                                        <h6>Previsualización de la media</h6>
                                                    </div>
                                                </div>
                                                <br />
                                            </div>
                                            <div class="row">
                                                <div class="col-xs-10 col-xs-offset-1 element-center">
                                                    <img id="imgPrev" src="{{Preview}}" ng-init="Preview='@ViewBag.Preview'" style="width:480px; height:270px" alt="">
                                                    @Html.HiddenFor(m => m.RealName, new { ng_model = "Media", ng_update_hidden = "", ng_init = "Media='" + Model.RealName + "'" })
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-xs-10 col-xs-offset-1 element-center">
                                                    @Html.ValidationMessageFor(m => m.RealName)
                                                </div>
                                            </div>
                                            <div ng-show="MsgInnerError" class="alert alert-danger element-center">
                                                <br />
                                                {{MsgInnerError}}
                                            </div>
                                            <br />

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row" ng-show="m.SourceType == 1">
                            <div class="col-xs-10 col-xs-offset-1">
                                <div class="panel panel-default panel-primary">
                                    <div class="panel-heading">
                                        <span class="glyphicon glyphicon-cloud-download"></span>&nbsp;&nbsp;@ResMediaRep.TITLE_MEDIA_EXTERNAL
                                    </div>
                                    <div class="panel-body">
                                        <div class="row">
                                            <div class="col-xs-11 col-xs-offset-1">
                                                <div class="row">
                                                    <div class="col-xs-1 element-right">
                                                        @Html.LabelFor(m => m.Url, new { @class = "control-label" })
                                                    </div>
                                                    <div class="col-xs-11">
                                                        @Html.TextBoxFor(m => m.Url, new { @class = "form-control" })
                                                    </div>
                                                    <div class="col-xs-11 col-xs-offset-1">
                                                        @Html.ValidationMessageFor(m => m.Url)
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <br />
                                        <div class="row">
                                            <div class="col-xs-11 col-xs-offset-1">
                                                <div class="col-xs-11 col-xs-offset-1">
                                                    <div class="input-group">
                                                        <span class="input-group-addon">
                                                            @Html.CheckBoxFor(m => m.IsWebPage, new { ng_model = "m.IsWebPage" })
                                                        </span>
                                                        <label class="form-control">Mostrar como una página web</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                    <br />
                    <div class="row">
                        <div class="col-xs-12">
                            <div ng-show="MsgError" class="alert alert-danger element-center">
                                {{MsgError}}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <span class="btn btn-default btn-sm" ng-click="cancel()">
                        @ResShared.BUTTON_CANCEL
                    </span>
                    <span class="btn btn-default btn-primary btn-sm" ng-disabled="WaitFor==true"
                          ng-click="submit('#FormCatId', '@Url.Action("DoUpsert", "Media", new {area = ""})')">
                        @ResShared.BUTTON_SAVE
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>

